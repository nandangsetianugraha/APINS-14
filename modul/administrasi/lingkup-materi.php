<?phprequire_once '../../config/db_connect.php';
$kelas=$_GET['kelas'];$mp=$_GET['mp'];$smt=$_GET['smt'];$ab=substr($kelas,0,1);$sql = "select * from lingkup_materi where kelas='$ab' and smt='$smt' and mapel='$mp' order by lm asc";$query = $connect->query($sql);$mapel=$connect->query("select * from mata_pelajaran where id_mapel='$mp'")->fetch_assoc();if($mp==0){	echo "<div class='alert alert-info alert-dismissible'><h4><i class='icon fa fa-info'></i> Informasi</h4>Silahkan Pilih Materi</div>";}else{?>	<button type="button" class="btn rounded-0 btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#modalmateri">Lingkup Materi</button>	<input type="hidden" class="form-control" id="smt" name="smt" value="<?=$smt;?>">		<table class="table table-bordered table-striped table-vcenter js-dataTable-full" id="tpTable">        <thead>            <tr>                <th>Kode Materi</th>				<th>Lingkup Materi</th>				<th class="d-none d-sm-table-cell"></th>            </tr>        </thead>        <tbody>			<?php 			while($s=$query->fetch_assoc()) {				$ids=$s['id_lm'];			?>			<tr>				<td><?=$s['lm'];?></td>				<td><?=$s['nama_lm'];?></td>				<td>					<button class="btn btn-effect-ripple btn-xs btn-danger" onclick="removeMateri('<?=$ids;?>')"> <i class="fa fa-trash"></i></button>				</td>			</tr>			<?php 			}			?>                          </tbody>    </table>	<?php };
?><script>$("#tpTable").DataTable({pageLength:5,lengthMenu:[[5,10,20],[5,10,20]],autoWidth:!1});		$("#buatmateri").unbind('submit').bind('submit', function() {			var form = $(this);			//submi the form to server			$.ajax({				url : form.attr('action'),				type : form.attr('method'),				data : form.serialize(),				dataType : 'json',				success:function(response) {					if(response.success == true) {						$("#modalmateri").modal('hide');						Codebase.helpers('jq-notify', {							align: 'center',             // 'right', 'left', 'center'							from: 'bottom',                // 'top', 'bottom'							type: 'success',               // 'info', 'success', 'warning', 'danger'							icon: 'fa fa-info me-5',    // Icon class							message: response.messages						});						//swal(response.messages, {buttons: false,timer: 2000,});						var kelas = $('#kelas').val();						var smt = $('#smt').val();						var mp = $('#mp').val();						$("#tpTable").DataTable({						  pageLength: 5,						  lengthMenu: [							 [5, 10, 20],							 [5, 10, 20],						  ],						  autoWidth: !1,						  responsive: !0,						  "destroy":true,						  "searching": true,						  "paging":true,						  "ajax": "modul/materi/lm.php?kelas="+kelas+"&smt="+smt+"&tapel="+tapel+"&mp="+mp						});						//$("#createKDFormk")[0].reset();						// this function is built in function of datatables;					} else {						Codebase.helpers('jq-notify', {							align: 'center',             // 'right', 'left', 'center'							from: 'bottom',                // 'top', 'bottom'							type: 'success',               // 'info', 'success', 'warning', 'danger'							icon: 'fa fa-info me-5',    // Icon class							message: response.messages						});					}  // /else				} // success  			}); // ajax subit 							return false;		}); // /submit form for Tujuan		$('#modalmateri').on('show.bs.modal', function (e) {            var kelas = $('#kelas').val();			var tapel = $('#tapel').val();			var smt = $('#smt').val();			var mp = $('#mp').val();            //menggunakan fungsi ajax untuk pengambilan data            $.ajax({                type : 'post',                url : 'modul/materi/modal_materi.php',                data :  'kelas='+ kelas+"&smt="+smt+"&mp="+mp,				beforeSend: function()						{								$(".fetched-data").html('<div class="block block-rounded"><div class="block-content">Loading.....<br/><div class="spinner-grow spinner-grow text-primary" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-secondary" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-success" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-danger" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-warning" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-info" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-light" role="status"><span class="sr-only">Loading...</span></div><div class="spinner-grow spinner-grow text-dark" role="status"><span class="sr-only">Loading...</span></div></div></div>');						},                success : function(data){                $('.fetched-data').html(data);//menampilkan data ke dalam modal                }            });        });	function removeMateri(id = null) {		if(id) {			// click on remove button						Swal.fire({			  title: 'Yakin dihapus?',			  text: "Apakah anda yakin menghapus materi ini?",			  icon: 'warning',			  showCancelButton: true,			  confirmButtonColor: '#3085d6',			  cancelButtonColor: '#d33',			  confirmButtonText: 'Ya, Hapus!'			}).then((result) => {			  if (result.isConfirmed) {				$.ajax({						url: 'modul/materi/hapusmateri.php',						type: 'post',						data: {member_id : id},						dataType: 'json',						success:function(response) {							if(response.success == true) {														// refresh the table								var kelas = $('#kelas').val();								var tapel = $('#tapel').val();								var smt = $('#smt').val();								var mp = $('#mp').val();								$("#tpTable").dataTable({								  pageLength: 5,								  lengthMenu: [									 [5, 10, 20],									 [5, 10, 20],								  ],								  autoWidth: !1,								  responsive: !0,								  "destroy":true,								  "searching": true,								  "paging":true,								  "ajax": "modul/materi/lm.php?kelas="+kelas+"&smt="+smt+"&tapel="+tapel+"&mp="+mp								});								Codebase.helpers('jq-notify', {									align: 'center',             // 'right', 'left', 'center'									from: 'bottom',                // 'top', 'bottom'									type: 'success',               // 'info', 'success', 'warning', 'danger'									icon: 'fa fa-info me-5',    // Icon class									message: 'Materi berhasil dihapus!'								});							} else {								Swal.fire("Kesalahan",response.messages,"error");							}						}					});			  }			})					} else {			Swal.fire("Kesalahan","Error Sistem","error");		}	}</script>